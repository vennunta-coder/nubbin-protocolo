<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nubbin™ Protocolo</title>
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#f97316">
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-black text-white font-mono">

  <!-- HEADER -->
  <header class="p-4 flex justify-between items-center border-b border-gray-800">
    <h1 class="text-xl font-bold text-orange-500">Nubbin™ Protocolo</h1>
    <nav class="flex items-center space-x-4">
      <a href="#sobre" class="hover:text-orange-500">Sobre</a>
      <a href="#como" class="hover:text-orange-500">Como Funciona</a>
      <a href="#inclusao" class="hover:text-orange-500">Inclusão</a>
      <a href="#faq" class="hover:text-orange-500">FAQ</a>
      <!-- Botão Modo Treino -->
      <button id="toggleTreino" type="button" onclick="toggleTreino()"
        class="ml-4 px-3 py-2 rounded-xl border border-neutral-700 bg-neutral-900 text-xs flex items-center gap-2 hover:border-orange-500 hover:text-orange-500">
        🎓 <span id="badgeTreino">Treino: OFF</span>
      </button>
    </nav>
  </header>

  <!-- CONTEÚDO PRINCIPAL -->
  <main class="p-6">
    <section id="nivel1" class="mb-6">
      <h2 class="text-lg font-bold">Nível 1 – Teste Cognitivo</h2>
      <p>Memoriza a sequência:</p>
      <div id="sequencia" class="font-bold text-2xl my-2">???</div>
      <button onclick="iniciarSeq()" class="bg-orange-600 px-4 py-2 rounded">Estou pronto</button>
      <div id="responder" class="hidden mt-4">
        <input id="resposta" type="text" class="text-black px-2">
        <button onclick="verificarSeq()" class="bg-green-600 px-4 py-2 rounded">Enviar</button>
      </div>
    </section>

    <!-- Aqui podes expandir Nível 2, Nível 3 ... até 100 -->
  </main>

  <!-- FOOTER -->
  <footer class="p-4 text-center text-xs text-gray-500 border-t border-gray-800">
    © 2025 Nubbin™ Protocolo
  </footer>

  <!-- SDK Supabase -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

  <script>
  /* ==========================
     CONFIGURAÇÃO SUPABASE
     ========================== */
  const SUPABASE_URL = "https://SEU-PROJETO.supabase.co";
  const SUPABASE_KEY = "SUA-ANON-KEY";
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  /* ==========================
     VARIÁVEIS DO JOGO
     ========================== */
  const STORAGE_KEY = 'NUBBIN_PROGRESS_V1';
  let MODO_TREINO = (localStorage.getItem('NUBBIN_MODO_TREINO') === '1');
  let seq = "";
  let currentUser = null;

  /* ==========================
     FUNÇÕES MODO TREINO
     ========================== */
  function updateTreinoBadge(){
    const badge = document.getElementById('badgeTreino');
    if(!badge) return;
    if(MODO_TREINO){
      badge.textContent = 'Treino: ON';
      badge.classList.add('text-green-400');
    } else {
      badge.textContent = 'Treino: OFF';
      badge.classList.remove('text-green-400');
    }
  }
  function toggleTreino(){
    MODO_TREINO = !MODO_TREINO;
    localStorage.setItem('NUBBIN_MODO_TREINO', MODO_TREINO ? '1' : '0');
    updateTreinoBadge();
    alert(MODO_TREINO ? "Modo Treino ativado" : "Modo Treino desativado");
  }

  /* ==========================
     SUPABASE FUNÇÕES
     ========================== */
  async function registrar(nome, idade, local) {
    const { data, error } = await supabase.from("users").insert([{ name: nome, age: idade, location: local }]).select();
    if (error) { console.error(error); return null; }
    currentUser = data[0];
    return currentUser;
  }

  async function salvarProgresso(level, completed = true) {
    if (!currentUser) return;
    const { data, error } = await supabase.from("progress").upsert([{ user_id: currentUser.id, level, completed }]).select();
    if (error) console.error(error);
    return data;
  }

  async function salvarRanking(score) {
    if (!currentUser) return;
    const { data, error } = await supabase.from("ranking").insert([{ user_id: currentUser.id, score }]).select();
    if (error) console.error(error);
    return data;
  }

  async function carregarRanking() {
    const { data, error } = await supabase.from("ranking").select("*, users(name)").order("score", { ascending: false }).limit(10);
    if (error) { console.error(error); return []; }
    return data;
  }

  /* ==========================
     LÓGICA NÍVEL 1
     ========================== */
  function iniciarSeq(){
    seq = String(Math.floor(100 + Math.random()*900)); // gera 3 dígitos
    document.getElementById('sequencia').innerText = seq;
    setTimeout(()=>{ document.getElementById('sequencia').innerText = "???"; }, 2000);
    document.getElementById('responder').classList.remove('hidden');
  }

  function verificarSeq(){
    const resposta = document.getElementById('resposta').value.trim();
    if(resposta === seq){
      alert("Correto! Avança para o próximo nível.");
      salvarProgresso(1,true);
    } else {
      if(MODO_TREINO){
        alert("Falha (Treino). A sequência era: "+seq);
      } else {
        alert("Falha detectada, Recruta. Reinício do nível.");
      }
    }
  }

  // Iniciar badge
  document.addEventListener('DOMContentLoaded', updateTreinoBadge);
  </script>
</body>
</html>
